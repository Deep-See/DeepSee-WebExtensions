{"version":3,"file":"background.js","sourceRoot":"","sources":["../../src/browser_scripts/background.ts"],"names":[],"mappings":";;AACA,8DAA+D;AAC/D,oDAAiD;AACjD,iCAAuC;AACvC,6CAAsC;AAGtC,MAAM,CAAC,GAAQ,MAAM,IAAI,OAAO,CAAC;AAEjC,yCAAyC;AACzC,IAAI,gBAAgB,GAAG,kCAAkC,CAAC;AAC1D,CAAC,CAAC,aAAa,CAAC,SAAS,CAAC,WAAW,CAAC,GAAG,EAAE;IACvC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,GAAG,EAAE,gBAAgB,EAAE,CAAC,CAAC;AAC7C,CAAC,CAAC,CAAC;AAEH,sBAAsB;AACtB,MAAM,OAAO,GAAG,IAAI,6BAAa,EAAE,CAAC;AACpC,MAAM,QAAQ,GAAG,IAAI,eAAQ,CAAC,OAAO,CAAC,CAAC;AAEvC,oBAAa,CAAC,CAAC,MAAW,EAAE,MAAW,EAAE,EAAE;IACvC,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;IACpB,QAAQ,MAAM,CAAC,OAAO,EAAE;QACpB,KAAK,iBAAiB;YACtB,OAAO,IAAI,OAAO,CAAM,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE;gBACxC,IAAI,QAAQ,GAAG,QAAQ,CAAC,WAAW,EAAE,CAAC;gBACtC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;YAC7D,CAAC,CAAC,CAAC;QACH,KAAK,SAAS,CAAC,CAAC,OAAO,OAAO,CAAC,MAAM,CAAC,CAAC;QACvC,KAAK,gBAAgB,CAAC,CAAC,OAAO,QAAQ,CAAC,aAAa,EAAE,MAAM,EAAE,MAAM,CAAC,CAAC;QACtE,KAAK,eAAe,CAAC,CAAC,OAAO,QAAQ,CAAC,aAAa,EAAE,MAAM,EAAE,MAAM,CAAC,CAAC;QACrE,KAAK,gBAAgB,CAAC,CAAC,OAAO,cAAc,CAAC,MAAM,CAAC,CAAC;QACrD,KAAK,mBAAmB,CAAC,CAAC,OAAO,QAAQ,CAAC,iBAAiB,EAAE,MAAM,EAAE,MAAM,CAAC,CAAC;QAC7E,OAAO,CAAC,CAAC,OAAO,SAAS,CAAC;KAC7B;AACL,CAAC,CAAC,CAAC;AAEH,SAAS,QAAQ,CAAC,IAAc,EAAE,MAAW,EAAE,MAAW;IACtD,IAAI,aAAa,GAAG,wBAAwB,CAAC;IAC7C,IAAI,MAAM,CAAC,GAAG,CAAC,UAAU,CAAC,aAAa,CAAC;QAAE,OAAO,IAAI,CAAC,MAAM,CAAC,CAAC;IAC9D,OAAO,IAAI,OAAO,CAAM,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE;QACxC,OAAO,CAAC,IAAI,CAAC,sDAAsD,CAAC,CAAC;QACrE,OAAO,EAAE,CAAC;IACd,CAAC,CAAC,CAAC;AACP,CAAC;AAED,SAAS,OAAO,CAAC,MAAW;IACxB,IAAI,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC;IAC5B,IAAI,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC;IAC5B,IAAI,OAAO,GAAG,QAAQ,CAAC,iBAAiB,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC;IACvE,OAAO,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;AACnD,CAAC;AAED,SAAS,aAAa,CAAC,UAAkB;IACrC,IAAI,OAAO,GAAG,qBAAO,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC;IAC7C,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;AACpC,CAAC;AAED,SAAS,aAAa,CAAC,IAAY;IAC/B,QAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;AACjC,CAAC;AAED,SAAS,cAAc,CAAC,MAAW;IAC/B,IAAI,OAAO,GAAG,QAAQ,CAAC,iBAAiB,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;IAC9E,OAAO,OAAO,CAAC,cAAc,EAAE,CAAC;AACpC,CAAC;AAED,SAAS,iBAAiB,CAAC,MAAW;IAClC,QAAQ,CAAC,qBAAqB,CAAC,MAAM,CAAC,IAAI,EAAE,MAAM,CAAC,WAAW,CAAC,CAAC;AACpE,CAAC","sourcesContent":["\nimport { AWClient } from '../../../AdaptiveWeb-Core/dist/main';\nimport { WebExtWrapper } from '../WebExtWrapper';\nimport { handleMessage } from './util';\nimport { Adapter } from 'adaptiveweb';\n\ndeclare var chrome: any, browser: any;\nconst b: any = chrome || browser;\n\n// Handles user clicking on browser icon.\nlet customisationUrl = 'https://adaptiveweb.io/customize';\nb.browserAction.onClicked.addListener(() => {\n    b.tabs.create({ url: customisationUrl });\n});\n\n// Initiate the client\nconst wrapper = new WebExtWrapper();\nconst awClient = new AWClient(wrapper);\n\nhandleMessage((bundle: any, sender: any) => {\n    console.log(bundle);\n    switch (bundle.message) {\n        case 'requestAdapters':\n        return new Promise<any>((resolve, reject) => {\n            let adapters = awClient.getAdapters();\n            resolve(Object.keys(adapters).map(key => adapters[key]));\n        });\n        case 'request': return request(bundle);\n        case 'installAdapter': return validate(attachAdapter, bundle, sender);\n        case 'removeAdapter': return validate(removeAdapter, bundle, sender);\n        case 'getPreferences': return getPreferences(bundle);\n        case 'updatePreferences': return validate(updatePreferences, bundle, sender);\n        default: return undefined;\n    }\n});\n\nfunction validate(next: Function, bundle: any, sender: any): Promise<any> {\n    let allowedOrigin = 'https://adaptiveweb.io';\n    if (sender.url.startsWith(allowedOrigin)) return next(bundle);\n    return new Promise<any>((resolve, reject) => {\n        console.warn('Configuration intent received from disallowed origin');\n        resolve();\n    });\n}\n\nfunction request(bundle: any) {\n    let uuid = bundle.data.uuid;\n    let args = bundle.data.args;\n    let context = awClient.getAdapterContext(awClient.getAdapters()[uuid]);\n    return context.request(args.url, args.options);\n}\n\nfunction attachAdapter(rawAdapter: string) {\n    let adapter = Adapter.fromObject(rawAdapter);\n    awClient.attachAdapter(adapter);\n}\n\nfunction removeAdapter(uuid: string) {\n    awClient.detachAdapter(uuid);\n}\n\nfunction getPreferences(bundle: any) {\n    let context = awClient.getAdapterContext(awClient.getAdapters()[bundle.data]);\n    return context.getPreferences();\n}\n\nfunction updatePreferences(bundle: any) {\n    awClient.setAdapterPreferences(bundle.uuid, bundle.preferences);\n}"]}